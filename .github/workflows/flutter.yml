name: Setup Flutter Project
on:
  workflow_dispatch: # මේක Button එකක් එබුවම විතරක් වැඩ කරන විදිහට දැම්මා

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.0'

      - name: Create Flutter App
        run: |
          # දැනට තියෙන ෆයිල්ස් ටික තියෙද්දීම Flutter Project එක හදනවා
          flutter create --org com.danithu --project-name fridge_to_table . --overwrite

      - name: Configure AdMob in AndroidManifest
        run: |
          # AndroidManifest එකට AdMob Meta Data එක ඇතුල් කිරීම
          FILE="android/app/src/main/AndroidManifest.xml"
          sed -i '/<\/application>/i \        <meta-data android:name="com.google.android.gms.ads.APPLICATION_ID" android:value="${{ secrets.ADMOB_APP_ID }}"/>' $FILE

      - name: Set MinSDK to 21
        run: |
          # build.gradle එකේ minSdkVersion 21 කිරීම
          sed -i 's/minSdkVersion flutter.minSdkVersion/minSdkVersion 21/g' android/app/build.gradle

      - name: Commit and Push Changes
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add .
          git commit -m "Initialize Flutter Project with AdMob Config"
          git push
